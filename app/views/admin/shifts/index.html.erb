<div class="page">
  <div class="pageHead">
    <h1 class="pageHead__title">シフト管理</h1>

    <div class="pageHead__actions">
    </div>
  </div>

  <section class="card">
    <div class="card__body">
      <div class="shiftToolbar">
        <div class="filter">
          <div class="filter__label">表示グループ</div>

          <%= form_with url: admin_shifts_path, method: :get, local: true do %>
            <%= select_tag :group_id,
                  options_from_collection_for_select(@groups, :id, :name, @group_id),
                  class: "select select--sm",
                  onchange: "this.form.submit();" %>

            <%= hidden_field_tag :view, @view_mode %>
            <% if @view_mode == "month" %>
              <%= hidden_field_tag :month, @month&.strftime("%Y-%m") %>
            <% else %>
              <%= hidden_field_tag :date, @date&.iso8601 %>
            <% end %>
          <% end %>
        </div>

        <div class="shiftToggle" role="tablist" aria-label="表示切替">
          <%= link_to "月別",
                admin_shifts_path(group_id: @group_id, view: "month", month: (@month || Date.current).strftime("%Y-%m")),
                class: "shiftToggle__btn #{@view_mode == 'month' ? 'is-active' : ''}",
                role: "tab",
                aria: { selected: (@view_mode == "month").to_s } %>

          <%= link_to "日別",
                admin_shifts_path(group_id: @group_id, view: "day", date: (@date || Date.current).iso8601),
                class: "shiftToggle__btn #{@view_mode == 'day' ? 'is-active' : ''}",
                role: "tab",
                aria: { selected: (@view_mode == "day").to_s } %>
        </div>
      </div>

      <% if @group.nil? %>
        <p class="hint">グループが未作成です。先にグループを作成してください。</p>
      <% end %>

      <% if @group.present? && @view_mode == "month" %>
        <div class="shiftLockBar">
          <div class="shiftLockBar__info">
            <span class="shiftLockBar__label">希望休ロック</span>
            <span class="muted" style="font-size:12px;">ロックすると、スタッフは<%= @month&.strftime("%Y年%m月") %>の希望休を変更できなくなります</span>
          </div>
          <button
            class="btn btn--sm shiftLockBtn <%= @time_off_locked ? 'shiftLockBtn--locked' : '' %>"
            id="js-time-off-lock-btn"
            data-lock-url="<%= toggle_admin_time_off_locks_path %>"
            data-group-id="<%= @group_id %>"
            data-month="<%= @month&.strftime('%Y-%m') %>"
            data-locked="<%= @time_off_locked %>">
            <span class="shiftLockBtn__icon"><% if @time_off_locked %>🔒<% else %>🔓<% end %></span>
            <span class="shiftLockBtn__text"><%= @time_off_locked ? "ロック中" : "未ロック" %></span>
          </button>
        </div>
      <% end %>
    </div>

    <div class="card__body card__body--flush">
      <% if @view_mode == "day" %>
        <%= render "day" %>
      <% else %>
        <%= render "month" %>
      <% end %>
    </div>
  </section>
</div>
